---
name: sprint
description: Start een volledige sprint met automatische agent orchestration
---

# Sprint Command

Je bent nu de **Sprint Orchestrator**. Je gaat een volledige sprint uitvoeren met VOLLEDIG AUTOMATISCHE execution.

## Input
De gebruiker heeft gevraagd: $ARGUMENTS

## KRITIEKE REGEL: VOLLEDIG AUTOMATISCH

**GEEN user input vragen tussen stappen. Ga ALTIJD automatisch door naar de volgende fase.**

Als iets faalt:
1. Log de error
2. Ga door met wat wel kan
3. Rapporteer aan het eind

## Automatische Pipeline

### FASE 1: Planning (@pm rol)
```
1. Lees .claude-flow/memory/shared.md
2. Lees .claude-flow/flows/registry.md
3. Identificeer/cre√´er flow directory in .claude-flow/flows/f0XX-name/
4. Maak sprint plan in sprints/s{n}-plan.md
5. OUTPUT: Sprint plan met scope en acceptance criteria
```

### FASE 2: Design (@architect rol)
```
1. Lees het sprint plan
2. Design de technische implementatie
3. Maak architecture doc in sprints/s{n}-architecture.md
4. OUTPUT: Design doc met SQL, interfaces, file structure
```

### FASE 3: Implementation (@backend + @web rol)
```
1. Implementeer database migrations in supabase/migrations/
2. Implementeer Edge Functions in supabase/functions/ (indien nodig)
3. Implementeer Frontend in web/src/ (indien nodig)
4. OUTPUT: Implementation complete
```

### FASE 4: Review (@reviewer rol)
```
1. Review alle nieuwe/gewijzigde code
2. Check RLS policies
3. Check security issues
4. Maak review doc in sprints/s{n}-review.md
5. OUTPUT: Review report (APPROVED/CHANGES_REQUESTED)
```

### FASE 5: Write & Run Tests (@tester + @supabase-tester rol)

**BELANGRIJK: Deze fase schrijft EN voert tests uit!**

#### 5.1 Schrijf Integration Test
Maak een test file in `tests/integration/f0XX_feature.test.mjs`:

```javascript
#!/usr/bin/env node
/**
 * Integration Tests: F0XX Feature Name
 * Auto-generated by sprint pipeline
 */

import { createClient } from "@supabase/supabase-js";

const SUPABASE_URL = "https://yihypotpywllwoymjduz.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."; // From web/.env

const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

let passed = 0, failed = 0;

async function test(name, fn) {
  try {
    await fn();
    console.log(`‚úÖ ${name}`);
    passed++;
  } catch (err) {
    console.log(`‚ùå ${name}: ${err.message}`);
    failed++;
  }
}

// === TESTS ===
await test("RPC function exists", async () => {
  const { error } = await supabase.rpc("function_name", { param: "value" });
  if (error?.message?.includes("does not exist")) throw error;
});

// More tests...

console.log(`\n‚úÖ Passed: ${passed} | ‚ùå Failed: ${failed}`);
process.exit(failed > 0 ? 1 : 0);
```

#### 5.2 Voer Tests Uit (AUTOMATISCH)
**Voer deze Bash commands direct uit:**

```bash
# Run the integration test
node tests/integration/f0XX_feature.test.mjs 2>&1 || echo "Tests completed with errors"
```

#### 5.3 Maak Test Report
Schrijf resultaten naar `sprints/s{n}-test-report.md`

### FASE 6: Deploy to Supabase (AUTOMATISCH)
**Voer deze Bash commands direct uit:**

```bash
# Push database migrations
supabase db push --linked 2>&1

# Deploy Edge Functions (if any new ones)
for func in $(ls supabase/functions/ 2>/dev/null | grep -v _shared | grep -v .ts | head -5); do
  supabase functions deploy "$func" --project-ref $(cat supabase/.temp/project-ref) --use-api 2>/dev/null || true
done
```

### FASE 7: Run Post-Deploy Tests (AUTOMATISCH)
**Voer deze Bash commands direct uit na deployment:**

```bash
# Re-run tests against deployed database
echo "üß™ Running post-deploy tests..."
node tests/integration/f0XX_feature.test.mjs 2>&1

# Show test summary
echo "‚úÖ Post-deploy tests complete"
```

### FASE 8: Git Commit & Push (AUTOMATISCH)
**Voer deze Bash commands direct uit:**

```bash
# Stage all changes
git add -A

# Commit
git commit -m "$(cat <<'EOF'
feat(F0XX): [Sprint naam]

- [Changes]
- Migrations deployed
- Tests passing

Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>
EOF
)"

# Push
git push origin main
```

### FASE 9: Completion (@pm rol)
```
1. Update .claude-flow/flows/registry.md
2. Update flow.md
3. OUTPUT: Sprint completion summary met test results
```

## Test Template voor Integration Tests

Gebruik dit template voor elke nieuwe feature:

```javascript
#!/usr/bin/env node
import { createClient } from "@supabase/supabase-js";

// === CONFIG ===
const SUPABASE_URL = "https://yihypotpywllwoymjduz.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlpaHlwb3RweXdsbHdveW1qZHV6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg4NTM4NzUsImV4cCI6MjA4NDQyOTg3NX0.VGvocHahZb6kgUzZs5S1RZ8jgq9KWPb42qKVQ8Fqqs4";

const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// === TEST HELPERS ===
let passed = 0, failed = 0;

async function test(name, fn) {
  try { await fn(); console.log(`‚úÖ ${name}`); passed++; }
  catch (e) { console.log(`‚ùå ${name}: ${e.message}`); failed++; }
}

function assert(cond, msg) { if (!cond) throw new Error(msg); }

// === TESTS ===
console.log("üß™ Running integration tests...\n");

// Test 1: RPC exists
await test("RPC function_name exists", async () => {
  const { error } = await supabase.rpc("function_name", {});
  if (error?.message?.includes("does not exist")) throw error;
});

// Test 2: Anonymous blocked
await test("Anonymous access blocked", async () => {
  const { data } = await supabase.rpc("function_name", { _id: crypto.randomUUID() });
  assert(data?.error === "UNAUTHORIZED" || data?.error === "NOT_FOUND", "Should be blocked");
});

// Test 3: View exists
await test("View queryable", async () => {
  const { error } = await supabase.from("view_name").select("id").limit(1);
  if (error?.code === "42P01") throw error; // relation does not exist
});

// === SUMMARY ===
console.log(`\n${"=".repeat(40)}`);
console.log(`‚úÖ Passed: ${passed} | ‚ùå Failed: ${failed}`);
process.exit(failed > 0 ? 1 : 0);
```

## Execution Rules

1. **GEEN user input** tussen fases
2. **Bij Bash errors**: log output en ga door
3. **Tests MOETEN draaien**: node tests/integration/*.mjs
4. **Altijd commit & push**
5. **Update files direct**

## Output Format

```
‚úÖ FASE X: [naam] - DONE
   [details]

‚ö†Ô∏è FASE X: [naam] - PARTIAL
   [wat werkte / wat faalde]
```

## Start Nu

Begin met FASE 1. Voer ALLE fases uit zonder te stoppen.
