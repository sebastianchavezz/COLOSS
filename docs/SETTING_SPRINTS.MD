---

## ğŸŸ¢ SPRINT 0 â€” Settings Fundament (DONE)

### ğŸ¯ Doel
Een **veilig, uitbreidbaar settings-platform** bouwen waarop alle toekomstige configuratie steunt.

### Backend â€” âœ… VOLTOOID
- `get_event_config`  
  â†’ merged config (system â†’ org â†’ event)
- `set_event_config`  
  â†’ PATCH-semantics (merge, geen replace)  
  â†’ audit logging
- `reset_event_config_domain`
- `get_event_config_permissions`
- Event overrides losgekoppeld van defaults
- Audit trail voor settings-wijzigingen
- Bugfix: `entity_id` UUID/text mismatch

### RBAC â€” âœ… VOLTOOID
| Domein | Rollen |
|------|-------|
| Payments | owner, admin, finance |
| Transfers | owner, admin, support |
| Communication | owner, admin, support |

### Frontend â€” âœ… VOLTOOID
- Settings tabs: Payments / Transfers / Communication
- Disabled fields bij onvoldoende rechten
- â€œReset to defaultsâ€ per domein
- Inline validatie
- Toast notifications
- Debug panel via `?debug=1`

**Status:** ğŸŸ¢ DONE  
**Opmerking:** Dit is architecturaal **sterker dan Atleta**, dat geen echte merge-logica heeft.

---

## ğŸŸ¢ SPRINT 1 â€” Governance & Legal (DONE)

> Lage UI-kost, hoge juridische & security impact

### Settings-domeinen
- `governance` (visibility)
- `legal` (terms & conditions)

### Backend â€” âœ… VOLTOOID
- `governance.is_private` toggle
- `public_events` view (excludes private events)
- `is_event_public()` helper function
- Terms & Conditions modes:
  - `none`
  - `pdf` (+ pdf_file_id)
  - `url` (+ url field)
  - `inline_text` (+ i18n text per locale)
- Domain constraint uitgebreid naar 5 domeinen
- RBAC: alleen owner/admin kan governance/legal wijzigen
- Validatie in `validate_setting_domain()`
- **DB-level enforcement via BEFORE trigger** âœ…
  - `enforce_event_settings_validation` trigger
  - `enforce_org_settings_validation` trigger
  - Voorkomt invalid data via direct INSERT/UPDATE
- Audit logging voor alle wijzigingen

### RBAC â€” âœ… VOLTOOID
| Domein | Rollen |
|------|-------|
| Governance | owner, admin |
| Legal | owner, admin |

### Frontend â€” âœ… VOLTOOID
- Nieuwe "Governance" tab (eerste positie)
- Toggle "Besloten evenement" met uitleg
- Terms mode dropdown (none/pdf/url/inline_text)
- Conditional inputs:
  - PDF: file ID veld
  - URL: link input
  - Inline: textarea per locale (nl/en)
- Disabled fields voor support/finance
- Reset to defaults per sectie

### Enforcement
- `public_events` view: excludes is_private=true
- `is_event_public()`: helper voor queries
- **Validation triggers op DB-niveau** âœ…
- Checkout enforcement: TODO (volgt in checkout feature)

### Verificatie
- `verify_sprint1_governance.sql` beschikbaar
- `verify_settings_trigger.sql` beschikbaar âœ…
- Edge cases getest:
  - Invalid mode â†’ ERROR âœ…
  - Valid mode â†’ SUCCESS âœ…
  - RBAC check support role âœ…

**Status:** ğŸŸ¢ DONE

---

## âœ… SPRINT 2 â€” Content & Communicatie (DONE)

**Testresultaten: SUCCESVOL** ğŸ‰

> Multilocale content, bewust **zonder zware editors** in v1

---

### Overzicht

Sprint 2 (Content & Communicatie) is **volledig getest** op database-niveau en alle validaties, constraints en businessregels werken zoals ontworpen.

---

### Settings-domeinen
- `basic_info` (event naam, omschrijving, contact)
- `content_communication` (checkout message, email subject/body, extra recipients)

---

### Backend â€” Validatie & Data-integriteit (SQL)

**i18n / Locale validatie**
- Toegestane locales: `nl, en, fr, de, es, it, pt`
- Ongeldige locale (bv. `"xx"`) â†’ **hard reject** âœ…
  > `ERROR: Invalid locale key "xx"`

**basic_info**
- Meertalige `name` en `description` werken correct âœ…
- `contact_email` en `website` correct opgeslagen âœ…

**content_communication**
- Meertalige velden:
  - `checkout_message`
  - `email_subject`
  - `email_body`
  â†’ alle correct gevalideerd per locale âœ…

**extra_recipients**
- Maximaal **5** e-mailadressen â†’ enforced âœ…
- Meer dan 5 â†’ **ERROR** âœ…
- Duplicaten â†’ **ERROR** âœ…
- Ongeldig e-mailformaat â†’ **ERROR** âœ…
- Geldige lijst (â‰¤5, uniek, geldig formaat) â†’ **SUCCES** âœ…

**Triggers & Validatie**
- `trigger_validate_setting()` actief op `event_settings` âœ…
- Alle writes (INSERT/UPDATE) lopen via `validate_setting_domain()` âœ…
- Ongeldige data kan **niet** meer in de database terechtkomen âœ…

**Data-veiligheid**
- Mislukte writes laten bestaande geldige data intact âœ…
- Laatst geldige `content_communication` configuratie blijft behouden âœ…

---

### RBAC â€” âœ… VOLTOOID
| Domein | Rollen |
|------|-------|
| basic_info | owner, admin |
| content_communication | owner, admin |

---

### Frontend â€” âœ… VOLTOOID
- Nieuwe "Content" tab (tweede positie)
- **Locale switcher** (NL/EN/FR tabs)
- Event naam/omschrijving per locale
- Contact email + website velden
- Checkout bevestigingsbericht per locale
- E-mail onderwerp + body per locale
- 5 input velden voor extra notificatie-ontvangers
- Disabled fields voor support/finance
- Reset to defaults per sectie

---

### Bewuste beperkingen
- âŒ Geen mail template editor
- âŒ Geen variabelen-UI
- âŒ Geen preview engine
- âŒ Geen HTML sanitization

---

### Verificatie
- `verify_sprint2_content.sql` beschikbaar âœ…

---

### Conclusie

- âœ… Sprint 2 backend is **correct, robuust en production-ready**
- âœ… Alle functionele en negatieve testcases zijn geslaagd
- âœ… Validatie wordt **op DB-niveau afgedwongen**, onafhankelijk van frontend
- âœ… Geen regressies of datacorruptie vastgesteld

**Status:** ğŸŸ¢ DONE

---

## âœ… SPRINT 3 â€” Branding (Light) (DONE)

**Testresultaten: SUCCESVOL** ğŸ‰

> Branding zonder checkout preview engine

---

### Settings-domeinen
- `branding` (hero_image_id, logo_image_id, primary_color)

---

### Backend â€” Validatie & Data-integriteit (SQL)

| Test | Resultaat |
|------|-----------|
| `branding` domain toegestaan | âœ… |
| Geldige hex kleur #RRGGBB | âœ… |
| Short hex (#FFF) geweigerd | âœ… |
| `hero_image_id` UUID validatie | âœ… |
| `logo_image_id` UUID validatie | âœ… |
| Geldige UUID's geaccepteerd | âœ… |
| Triggers (`trigger_validate_setting`) actief | âœ… |
| Ongeldige data kan DB niet binnen | âœ… |

**Helpers & Defaults**
- `is_valid_hex_color()` function werkt correct âœ…
- Default kleur `#4F46E5` blijft valide fallback âœ…

**Data-integriteit**
- Foutieve updates worden geblokkeerd âœ…
- Geldige bestaande data blijft intact âœ…
- JSON-merge gedrag werkt correct (`jsonb_set`) âœ…

---

### TODO (Future Sprint)
- âš ï¸ Storage existence validation via Edge Function + service_role
- âš ï¸ Mime-type validatie tegen storage metadata
- âš ï¸ File size validatie (hero: 5MB, logo: 2MB)
- âš ï¸ Herverificatie bij checkout/PDF generatie

---

### RBAC â€” âœ… VOLTOOID
| Domein | Rollen |
|------|-------|
| branding | owner, admin |

---

### Frontend â€” âœ… VOLTOOID
- Nieuwe "Branding" tab (derde positie)
- Hero image ID input (UUID)
- Logo image ID input (UUID)
- Native color picker + hex input
- Inline validatie (#RRGGBB formaat)
- Disabled fields voor support/finance
- Reset to defaults

---

### Verificatie
- `verify_sprint3_branding.sql` beschikbaar âœ…

---

### Bewuste beperkingen
- âŒ Geen preview engine
- âŒ Geen image cropping
- âŒ Geen file upload UI (komt in toekomstige sprint)
- âŒ Geen storage existence check (TODO)

---

### Conclusie

- âœ… Sprint 3 is **production-ready**
- âœ… Branding settings zijn **veilig, strikt gevalideerd en uitbreidbaar**
- âœ… Alle functionele en negatieve testcases zijn geslaagd
- âœ… Geen regressies in Sprint 0â€“2

**Status:** ğŸŸ¢ DONE

---

## âœ… SPRINT 4 â€” Wachtlijst & Interesselijst (DONE)

**Testresultaten: SUCCESVOL** ğŸ‰

> Settings en enforcement logic voor wachtlijst en interesselijst

---

### Backend â€“ Validatie & Enforcement

Alles werkt exact zoals ontworpen.

**Waitlist**
- `waitlist.enabled = true` â†’ correct opgeslagen âœ…
- Ongeldige key (`{"invalid": true}`) â†’ hard reject âœ…
- `can_join_waitlist(event_id)`:
  - Werkt correct met auth-context
  - Geeft `true` terug wanneer enabled âœ…

**Interest List**
- `interest_list.enabled = true` â†’ correct opgeslagen âœ…
- Ongeldige key â†’ hard reject âœ…
- `can_join_interest_list(event_id)`:
  - Werkt correct met auth-context
  - Geeft `true` terug wanneer enabled âœ…

**RBAC**
- Alleen org owner/admin mag configs lezen/wijzigen âœ…
- Enforcement helpers zijn correct beschermd via `get_event_config()` + `is_org_member()` âœ…

**Validatie**
- Key whitelist (`enabled` only) correct afgedwongen âœ…
- Default gedrag (`enabled = false` indien geen row) correct âœ…
- Triggers (`trigger_validate_setting`) werken voor beide domeinen âœ…

---

### Frontend â€” âœ… VOLTOOID
- Nieuwe "Wachtlijst & Interesse" tab
- Toggle voor Wachtlijst
- Toggle voor Interesselijst
- Duidelijke uitleg per sectie
- Disabled fields voor support/finance
- Reset to defaults

---

**Status:** ğŸŸ¢ DONE

---

## ğŸ”’ SPRINT 5 â€” Deelnemersdashboard & Mutaties (GEPAUZEERD)

> Hoog risico, afhankelijk van refunds & upgrades

### Settings-domeinen
- `participant_dashboard`
- `ticket_permissions`

### Vereist
- Lock dates
- Per-ticket overrides
- Mutation policies

**Status:** ğŸ”’ ON HOLD  
**Reden:** afhankelijk van toekomstige refund/upgrade flows

---

## âœ… SPRINT 6 â€” Ticket-PDF & Privacy (DONE)

**Testresultaten: SUCCESVOL** ğŸ‰

> Settings voor ticket beschikbaarheid en privacy

---

### Settings-domeinen
- `ticket_pdf` (available_from, banner_image_id)
- `ticket_privacy` (show whitelist)

---

### Backend â€” Validatie & Enforcement (SQL)

| Test | Resultaat |
|------|-----------|
| `ticket_pdf` domain toegestaan | âœ… |
| `ticket_privacy` domain toegestaan | âœ… |
| `available_from` ISO-8601 validatie | âœ… |
| `banner_image_id` UUID validatie | âœ… |
| Privacy keys whitelist enforcement | âœ… |
| Privacy values boolean enforcement | âœ… |

**Enforcement Helpers**
- `are_tickets_available()` (Time-based check) âœ…
- `get_ticket_privacy()` (Returns whitelist) âœ…

**RBAC**
- Owner/Admin only (Support/Finance read-only) âœ…

---

### Frontend â€” âœ… VOLTOOID
- Nieuwe "Tickets & Privacy" tab
- Datetime picker voor `available_from`
- Checkbox matrix voor privacy fields
- Banner Image ID input
- Disabled fields voor support/finance
- Reset to defaults

---

### Verificatie
- `verify_sprint6_ticket_pdf_privacy.sql` beschikbaar âœ…

**Status:** ğŸŸ¢ DONE

---

## â„ï¸ SPRINT 7 â€” Wachtrij (OPTIONEEL)

> Infra-intensief, niet MVP-kritisch

**Status:** â„ï¸ ON HOLD

---

## âŒ Bewust uitgesloten uit MVP Settings

| Feature | Reden |
|------|------|
| Checkout preview engine | UX-heavy |
| Full WYSIWYG editors | Security + scope |
| Partner attribution UI | Reporting eerst |
| Marketing automation | Post-MVP |
| Realtime settings updates | Nice-to-have |

---

## ğŸ§  Strategische Samenvatting

- âœ… Jullie hebben **exact de juiste basis** gelegd (Sprint 0)
- âœ… Settings functioneren als **policy engine**, niet als formulier
- âœ… Enforcement gebeurt **altijd backend-first**
- ğŸš€ Dit model schaalt verder dan Atleta

**Aanbevolen volgende stap:**  
â¡ï¸ **Sprint 1 (Governance & Legal) volledig implementeren**

---

## ğŸ“ Aanbevolen bestandsnaam